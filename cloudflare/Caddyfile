# Caddy reverse proxy for local High Command dev stack
# Matches k8s Gateway routing: / -> UI, /api -> API, /mcp -> MCP (with path rewrite)
# Run: caddy run --config Caddyfile
# Then: cloudflared tunnel --url http://localhost:8080

:8080 {
    # API - pass through as-is
    handle /api/* {
        reverse_proxy localhost:5000
    }

    # MCP - handle_path strips /mcp prefix, so /mcp/messages -> /messages (matches MCP server)
    handle_path /mcp/* {
        reverse_proxy localhost:8000
    }

    # UI - everything else
    handle {
        reverse_proxy localhost:3000
    }
}
